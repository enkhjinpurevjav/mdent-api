version: "3.9"

networks:
  mdent-core_mdent_net:
    external: true
    name: mdent-core_mdent_net

services:
  mdent_api:
    build: .
    image: mdent/api:latest
    container_name: mdent_api
    networks:
      - mdent-core_mdent_net
    environment:
      NODE_ENV: production
      # ‚Üê use mdent_test here
      DATABASE_URL: postgresql://mdent:Monfamily2025@mdent_postgres:5432/mdent_test?schema=public
    ports:
      - "8082:3000"
    # If you want live code from server instead of image (optional):
    # volumes:
    #   - /opt/mdent-api:/app
    command: sh -lc "npx prisma generate && node server.js"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/"]
      interval: 15s
      timeout: 3s
      retries: 10
